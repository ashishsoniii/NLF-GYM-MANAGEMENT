import{j as e,E as X,T as v,P as r,r as m,M as I,B as N,S as k,F as Z,I as B,H as ee,K as te,W as ne}from"./index-082a7ee0.js";import{a as W,C as L}from"./Card-d98dd1f2.js";import{T as w,a as y,G as j,b as se,c as ae,d as re,e as ie,f as le,g as oe}from"./TableSortLabel-7f049ea0.js";import{F as ce,I as de,S as me,T as C,O as ue}from"./TextField-e01313c8.js";import{L as he}from"./LoadingButton-ce7f91fa.js";import{C as xe}from"./Container-aed5469d.js";function q({query:t}){return e.jsx(w,{children:e.jsx(y,{align:"center",colSpan:6,sx:{py:3},children:e.jsxs(X,{sx:{textAlign:"center"},children:[e.jsx(v,{variant:"h6",paragraph:!0,children:"Not found"}),e.jsxs(v,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}q.propTypes={query:r.string};function z({setClickedTitle:t}){const[n,s]=m.useState({emailOption:"everyone",customEmails:"",name:"",email:"",subject:"",content:""}),[o,l]=m.useState(null),[d,u]=m.useState(!1),E=h=>{const{name:x,value:f}=h.target;s({...n,[x]:f})},a=h=>{s({...n,emailOption:h.target.value})},b=h=>{s({...n,customEmails:h.target.value})},T=async()=>{var h,x;u(!0);try{const f=localStorage.getItem("token"),S=await W.post("https://nlfgymback-fnbebqhpgkemhwft.centralindia-01.azurewebsites.net/member/sendEmail",n,{headers:{Authorization:`${f}`}});console.log("Email sent successfully:",S.data),s({emailOption:"everyone",customEmails:"",name:"",email:"",subject:"",content:""}),l("Email sent successfully"),t("All Email")}catch(f){console.error("Error sending email:",f),l(((x=(h=f.response)==null?void 0:h.data)==null?void 0:x.error)||"Error sending email")}finally{u(!1)}};return e.jsxs(j,{columnGap:1,item:!0,xs:!0,zeroMinWidth:!0,spacing:2,m:3,children:[e.jsx("h1",{children:" Add New plan"}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ce,{fullWidth:!0,sx:{mb:2},children:[e.jsx(de,{children:"Email Option"}),e.jsxs(me,{value:n.emailOption,onChange:a,label:"Email Option",children:[e.jsx(I,{value:"everyone",children:"Everyone"}),e.jsx(I,{value:"custom",children:"Custom"})]})]})}),n&&n.emailOption==="custom"&&e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{label:"Custom Emails",variant:"outlined",fullWidth:!0,name:"customEmails",value:n.customEmails,onChange:b,placeholder:"Enter emails separated by commas",sx:{mb:2}})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{label:"subject",variant:"outlined",fullWidth:!0,name:"subject",value:n.subject,onChange:E,sx:{mb:2}})}),e.jsx(j,{item:!0,xs:12,sm:6,md:6,children:e.jsx(C,{label:"content",variant:"outlined",fullWidth:!0,multiline:!0,rows:4,name:"content",value:n.content,onChange:E,sx:{mb:2}})}),e.jsxs(j,{item:!0,xs:12,sm:6,md:3,mx:3,children:[e.jsx(he,{variant:"contained",color:"primary",onClick:T,loading:d,children:"Send Email"}),o&&e.jsx(v,{variant:"body2",color:"error",sx:{mt:1},children:o})]})]})}z.propTypes={setClickedTitle:r.func};function M({email:t,selected:n}){return e.jsx(e.Fragment,{children:e.jsxs(w,{hover:!0,tabIndex:-1,duration:"checkbox",selected:n,children:[e.jsx(y,{children:t.nameTo}),e.jsx(y,{children:t.emailTo}),e.jsx(y,{children:t.subject}),e.jsx(y,{align:"center",children:new Date(t.sentAt).toISOString().slice(0,10).split("T")[0]})]})})}M.propTypes={email:r.any,selected:r.any};const pe={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function ge(t,n,s){return t?Math.max(0,(1+t)*n-s):0}function R(t,n,s){return t[s]===null?1:n[s]===null||n[s]<t[s]?-1:n[s]>t[s]?1:0}function je(t,n){return t==="desc"?(s,o)=>R(s,o,n):(s,o)=>-R(s,o,n)}function fe({inputData:t,comparator:n,filterName:s}){const o=t.map((l,d)=>[l,d]);return o.sort((l,d)=>{const u=n(l[0],d[0]);return u!==0?u:l[1]-d[1]}),t=o.map(l=>l[0]),s&&(t=t.filter(l=>l.name.toLowerCase().indexOf(s.toLowerCase())!==-1)),t}function _({order:t,orderBy:n,rowCount:s,headLabel:o,numSelected:l,onRequestSort:d,onSelectAllClick:u}){const E=a=>b=>{d(b,a)};return e.jsx(se,{children:e.jsx(w,{children:o.map(a=>e.jsx(y,{align:a.align||"left",sortDirection:n===a.id?t:!1,sx:{width:a.width,minWidth:a.minWidth},children:e.jsxs(ae,{hideSortIcon:!0,active:n===a.id,direction:n===a.id?t:"asc",onClick:E(a.id),children:[a.label,n===a.id?e.jsx(N,{sx:{...pe},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},a.id))})})}_.propTypes={order:r.oneOf(["asc","desc"]),orderBy:r.string,rowCount:r.number,headLabel:r.array,numSelected:r.number,onRequestSort:r.func,onSelectAllClick:r.func};function G({emptyRows:t,height:n}){return t?e.jsx(w,{sx:{...n&&{height:n*t}},children:e.jsx(y,{colSpan:9})}):null}G.propTypes={emptyRows:r.number,height:r.number};function P({title:t,total:n,icon:s,color:o="primary",sx:l,...d}){return e.jsxs(L,{component:k,spacing:3,direction:"row",sx:{px:3,py:5,borderRadius:2,...l},...d,children:[s&&e.jsx(N,{sx:{width:64,height:64},children:s}),e.jsxs(k,{spacing:.5,children:[e.jsx(v,{variant:"h4",children:n}),e.jsx(v,{variant:"subtitle2",sx:{color:"text.disabled"},children:t})]})]})}P.propTypes={color:r.string,icon:r.oneOfType([r.element,r.string]),sx:r.object,title:r.string,total:r.number};function H({numSelected:t,filterName:n,onFilterName:s}){return e.jsx(Z,{sx:{height:96,display:"flex",justifyContent:"space-between",p:o=>o.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:t>0?e.jsxs(v,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx(ue,{value:n,onChange:s,placeholder:"Search plan...",startAdornment:e.jsx(B,{position:"start",children:e.jsx(ee,{icon:"eva:search-fill",sx:{color:"text.disabled",width:20,height:20}})})})})}H.propTypes={numSelected:r.number,filterName:r.string,onFilterName:r.func};function be(){const[t,n]=m.useState(0),[s,o]=m.useState("All Email"),[l,d]=m.useState([]),[u,E]=m.useState("asc"),[a,b]=m.useState([]),[T,h]=m.useState("name"),[x,f]=m.useState(""),[S,U]=m.useState(5),A=i=>{o(i)},$=(i,c)=>{c!==""&&(E(T===c&&u==="asc"?"desc":"asc"),h(c))},O=async()=>{try{const i=localStorage.getItem("token"),c=await W.get("https://nlfgymback-fnbebqhpgkemhwft.centralindia-01.azurewebsites.net/member/emails",{headers:{Authorization:`${i}`}});d(c.data.emails),console.log("Error fetcaing plans:",c.data)}catch(i){console.error("Error fetcaing plans:",i)}};m.useEffect(()=>{O()},[s]);const D=i=>{if(i.target.checked){const c=l.map(p=>p.name);b(c);return}b([])},K=(i,c)=>{const p=a.indexOf(c);let g=[];p===-1?g=g.concat(a,c):p===0?g=g.concat(a.slice(1)):p===a.length-1?g=g.concat(a.slice(0,-1)):p>0&&(g=g.concat(a.slice(0,p),a.slice(p+1))),b(g)},Y=(i,c)=>{n(c)},J=i=>{n(0),U(parseInt(i.target.value,10))},Q=i=>{n(0),f(i.target.value)},F=fe({inputData:l,comparator:je(u,T),filterName:x}),V=!F.length&&!!x;return e.jsxs(xe,{children:[e.jsx(k,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsx(v,{variant:"h4",children:"Plans"})}),e.jsxs(j,{container:!0,spacing:3,m:5,gap:4,children:[e.jsx(j,{xs:12,sm:6,md:3,children:e.jsx(P,{total:"All Email",color:"success",sx:{cursor:"pointer","&:hover":{cursor:"pointer"}},onClick:()=>A("All Email"),icon:e.jsx("img",{alt:"icon",src:"/assets/icons/glass/ic_glass_bag.png"})})}),e.jsx(j,{xs:12,sm:6,md:3,children:e.jsx(P,{total:"Send Email",color:"info",sx:{cursor:"pointer","&:hover":{cursor:"pointer"}},onClick:()=>A("Send Email"),icon:e.jsx("img",{alt:"icon",src:"/assets/icons/glass/ic_glass_users.png"})})})]}),e.jsxs(L,{children:[s==="All Email"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{numSelected:a.length,filterName:x,onFilterName:Q}),e.jsx(te,{children:e.jsx(re,{sx:{overflow:"unset"},children:e.jsxs(ie,{sx:{minWidth:800},children:[e.jsx(_,{order:u,orderBy:T,rowCount:l.length,numSelected:a.length,onRequestSort:$,onSelectAllClick:D,headLabel:[{id:"name",label:"Name"},{id:"email",label:"Email"},{id:"subject",label:"Subject"},{id:"sendAt",label:"Send At",align:"center"}]}),e.jsxs(le,{children:[F.slice(t*S,t*S+S).map(i=>e.jsx(M,{fetchPlans:O,email:i,duration:i.email,description:i.subject,price:i.emailTo,selected:a.indexOf(i.name)!==-1,handleClick:c=>K(c,i.name)},i._id)),e.jsx(G,{height:77,emptyRows:ge(t,S,l.length)}),V&&e.jsx(q,{query:x})]})]})})}),e.jsx(oe,{page:t,component:"div",count:l.length,rowsPerPage:S,onPageChange:Y,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:J})]})," ",s==="Send Email"&&e.jsx(e.Fragment,{children:e.jsx(z,{setClickedTitle:o})})," "]})]})}function Ce(){return e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsx("title",{children:" Email | GYM "})}),e.jsx(be,{})]})}export{Ce as default};
